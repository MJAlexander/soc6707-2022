---
title: "Week 2: tidyverse, normal probabilities, ggplot"
author: "Monica Alexander"
date: "16/01/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```


# By the end of this lab you should know 

- How to read in data from a csv file
- How to view a dataset in R
- What the pipe `%>%` is 
- The functions `select`, `arrange`, `filter`, `mutate` and `summarize`
- How to calculate probabilities for the Normal distribution
- Know what `ggplot` is a do a first plot


# Load in the `tidyverse` package

The first thing we need to do (and the first thing you will usually need to do) is to load in the `tidyverse` R package

```{r}
library(tidyverse)
```


# Reading in data 

We now want to read in the GSS data: 

```{r}
# make sure the file name points to where you've saved the gss file
# for example, I have it saved in a "data" folder
gss <- read_csv(file = "../data/gss.csv")
```

You can look at the gss file by going to the "Environment" pane and clicking on the table icon next to the gss object, or by typing `View(gss)` into the console. 


# Important functions

This section illustrates some important functions that make manipulating datasets like the gss dataset much easier. 

## `select`

We can select a column from a dataset. For example the code below selects the column with the respondents age:

```{r}
select(gss, age) # taking the gss dataset, and selecting the age column
select(gss, age, education) # taking the gss dataset, selecting age and educ
```

## The pipe

Instead of selecting the age column like above, we can make use of the pipe function. This is the %>% notation. It looks funny but it may help to read it as like saying "and then". On a more technical note, it takes the first part of code and *pipes* it into the first argument of the second part and so on. So the code below takes the gss dataset AND THEN selects the age column:

```{r}
gss %>% 
  select(age)
```

Notice that the commands above don't save anything. Assign the age column to a new object called `gss_age`

```{r}
gss_age <- gss %>% select(age)
gss_age
```

## `arrange`

The `arrange` function sorts columns from lowest to highest value. So for example we can select the age column then arrange it from smallest to largest number. Note that this involves using the pipe twice (so taking gss AND THEN selecting age AND then arranging age).

```{r}
gss %>% 
  select(age) %>% 
  arrange(age)
```

If we wanted largest to smallest

```{r}
gss %>% 
  select(age) %>% 
  arrange(-age) # descending order
```


Side note: you need not press enter after each pipe but it helps with readability of the code. 

## `filter`

To filter rows based on some criteria we use the `filter` function. e.g. filter to only include those aged 30 or less:

```{r}
gss %>% 
  filter(age<=30)
```

Note that the new `gss_age` object is still a dataframe, it just has one column, called age. So when filtering this, you still need to specify which column/variable is being filtered. 

```{r}
filter(gss_age, age<=30)
```


Filter takes any logical arguments. If we want to filter by participants who identified as *Female*, we use `==` operator.

```{r}
gss %>% 
  filter(sex=="Female") # double equals 
# Female is a string/character variable, so it needs to go in "" 
```

## `mutate`

We can add columns using the mutate function. For example we may want to add a new column called `age_plus_1` that adds one year to everyone's age:

```{r}
gss_2 <- gss %>% 
  mutate(age_plus_1 = age + 1) 
```

## `summarize`

The `summarize` function is used to give summaries of one or more columns of a dataset. For example, we can calculate the mean age of all respondents in the gss:

```{r}
summaries <- gss %>% 
  summarise(mean_age = mean(age),
            median_age = median(age),
            sd_age = sd(age))

summaries
```

You may have seen the `mean` function written like this. This base syntax

- Extract columns using the dollar sign ($)
- Function starts the line

```{r}
mean(gss$age)
```


# Review questions

1. Create a new R Markdown file for these review questions
2. Find the mean age at first birth (age_at_first_birth) of respondents in the GSS.

```{r}
gss %>% 
  # select(age_at_first_birth) %>% # this line is optional
  summarize(mean_afb = mean(age_at_first_birth, na.rm = TRUE)) # removing the NAs
```

3. Create a new dataset that just contains GSS respondents who are less than 20 years old. 

```{r}
gss_young <- gss %>% 
  filter(age<20)
```


4. How many rows does the dataset in step 3 have?

```{r}
nrow(gss_young)
```


5. What is the largest case id in the dataset in step 3?

```{r}
gss_young %>% 
  arrange(-caseid)

# answer is 20539
```


# Calculating Normal probabilities 

We can calculate the cumulative probability that a value coming from a Normal distribution with a certain mean and standard deviation is below a certain value using the `pnorm` function. E.g. what the probability that a value is less than -1.25 from a standard Normal distribution (mean 0 and standard deviation 1) is

```{r}
pnorm(-1.25, mean = 0, sd = 1)

# probability that a value from a standard normal distribution is less than (or equal to) -1.25 is 0.106. 
```

## Questions

- What's the probability that a value is above -1.25?

```{r}
1 - pnorm(-1.25, mean = 0, sd = 1)
```


- What's the probability that a value is between -1.25 and 1.25?

```{r}
pnorm(1.25) - pnorm(-1.25)
```


- Pretend that population heights are Normally distributed with mean 160 and standard deviation 10 (in cm). Find the probability that a randomly selected person has a height less than yours?

```{r}
monica_height <- 168

# p(z< monica_height)
pnorm(monica_height, mean = 160, sd = 10)

```

- How many standard deviations above the mean is Monica's height?

```{r}
mu <- 160
sd <- 10

(monica_height - mu)/sd

```

- We are told that Ikee has a height with a Z score of 1.2. What is Ikee's height?

Z score is
$$
\frac{X - \mu}{\sigma}
$$
So want to solve for X (height)

$$
X = Z*\sigma + \mu
$$


```{r}
1.2*sd + mu
```


# My first `ggplot`

`ggplot` is a powerful visualization package. It provides many options to make beautiful graphs, maps, plots of all sort.

We are going to make a histogram of ages at first marriage in the gss dataset. 

```{r}
colnames(gss)
```



Code is in layers

- firstly you define your "canvas" (specifying your dataset, your axes variable (x and y))
- then you add the graph type (histogram, but could be line, point, boxplot, ....)
- then you play around with themes, labels, colors

Start off defining our canvas. The `ggplot` function has two main arguments

- data (where our data come from)
- `aes()` function (which is the aesthetics function), where we specify our x, y values, and other variables


```{r}
p <- ggplot(data = gss, aes(x = age_at_first_marriage))
p
```

The next thing we do is tell ggplot what type of graph we want. All graph types start with the prefix `geom_`

```{r}
p + geom_histogram()
```

Next we're going to fix the labels -- use `labs()` function

```{r}
p2 <- p +
  geom_histogram(fill = "#0000FF", color = "purple") + 
  labs(title = "Histogram of age at first marriage, GSS 2017",
       x = "Age at first marriage (years)")
p2
```

to pick your colors!!

```{r}
colors()
```


